<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>命令详情: {{ command.title }}</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; line-height: 1.6; color: #333; max-width: 900px; margin: 20px auto; padding: 0 15px; }
        .card { border: 1px solid #e0e0e0; border-radius: 8px; margin-bottom: 20px; box-shadow: 0 2px 4px rgba(0,0,0,0.05); }
        .card-header { background-color: #f7f7f7; padding: 12px 20px; border-bottom: 1px solid #e0e0e0; border-radius: 8px 8px 0 0; }
        .card-header h1, .card-header h2 { margin: 0; font-size: 1.5em; }
        .card-body { padding: 20px; }
        .textarea-container { position: relative; margin-bottom: 15px; }
        textarea { width: 100%; box-sizing: border-box; padding: 10px; border: 1px solid #ccc; border-radius: 4px; font-family: Consolas, Monaco, 'Andale Mono', 'Ubuntu Mono', monospace; min-height: 100px; white-space: pre; word-wrap: normal; overflow-x: auto;}
        .copy-btn { position: absolute; top: 8px; right: 8px; background-color: #007bff; color: white; border: none; border-radius: 4px; padding: 5px 10px; cursor: pointer; opacity: 0.8; }
        .copy-btn:hover { opacity: 1; }
        .details-grid { display: grid; grid-template-columns: 150px 1fr; gap: 10px; align-items: center; }
        .details-grid dt { font-weight: bold; text-align: right; color: #555; }
        ul { list-style-type: disc; padding-left: 20px; }
    </style>
</head>
<body>

    <div class="card">
        <div class="card-header">
            <h1>{{ command.title }}</h1>
        </div>
        <div class="card-body">
            <div class="details-grid">
                <dt>创建者:</dt> <dd>{{ command.user.username }}</dd>
                <dt>目标版本:</dt> <dd>{{ command.target_version.version_number }}</dd>
                <dt>基础物品:</dt> <dd>{{ command.base_item.name }} (<code>{{ command.base_item.item_id }}</code>)</dd>
                <dt>数量:</dt> <dd>{{ command.count }}</dd>
            </div>
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h2>生成结果</h2>
        </div>
        <div class="card-body">
            <p><strong>完整 /give 命令</strong> (可直接在游戏中使用)</p>
            <div class="textarea-container">
                <textarea id="give-command" readonly>{{ give_command_string }}</textarea>
                <button class="copy-btn" onclick="copyToClipboard('give-command')">复制</button>
            </div>

            <p><strong>数据结构 (JSON)</strong> (用于调试或理解结构)</p>
            <div class="textarea-container">
                <textarea id="data-json" readonly>{{ data_structure_json }}</textarea>
                <button class="copy-btn" onclick="copyToClipboard('data-json')">复制</button>
            </div>
        </div>
    </div>
    
    <div class="card">
        <div class="card-header">
            <h2>配置详情</h2>
        </div>
        <div class="card-body">
            {% if command.custom_name or command.lore %}
                <h3>显示属性</h3>
                <ul>
                    {% if command.custom_name %}<li><strong>自定义名称:</strong> <code>{{ command.custom_name }}</code></li>{% endif %}
                    {% if command.lore %}<li><strong>Lore:</strong> <pre>{{ command.lore }}</pre></li>{% endif %}
                </ul>
                <hr>
            {% endif %}

            {% if command.enchantments.all %}
                <h3>附魔</h3>
                <ul>
                {% for applied_enchantment in command.enchantments.all %}
                    <li>{{ applied_enchantment.enchantment.name }} - 等级 {{ applied_enchantment.level }}</li>
                {% endfor %}
                </ul>
                <hr>
            {% endif %}

            {% if command.attributes.all %}
                <h3>属性修改器</h3>
                <ul>
                {% for attr in command.attributes.all %}
                    <li>
                        {{ attr.attribute.name }}: <strong>{{ attr.amount }}</strong> 
                        (操作: {{ attr.get_operation_display }}, 槽位: {{ attr.get_slot_display }})
                        {% if attr.modifier_name %}<small> [旧版名称: {{ attr.modifier_name }}]</small>{% endif %}
                    </li>
                {% endfor %}
                </ul>
            {% endif %}
        </div>
    </div>
    
    <a href="/MC_command/">返回上一页</a>

    <script>
        function copyToClipboard(elementId) {
            const textarea = document.getElementById(elementId);
            textarea.select();
            textarea.setSelectionRange(0, 99999); // For mobile devices
            try {
                navigator.clipboard.writeText(textarea.value);
                alert('已复制到剪贴板！');
            } catch (err) {
                alert('复制失败，请手动复制。');
            }
        }
    </script>
</body>
</html>