{% comment %} 
I have added error display blocks for non-field errors and for each field,
which will make validation errors visible to the user.
{% endcomment %}
{% for field in form.hidden_fields %}{{ field }}{% endfor %}
<div class="errorlist">{{ form.non_field_errors }}</div>
<div class="errorlist">{{ form.colors.errors }}</div>
<div class="errorlist">{{ form.fade_colors.errors }}</div>

<div id="{{ form.prefix }}-row" class="dynamic-form firework-form-row">
    
    {# 这是一个隐藏的复选框，由我们的JS代码控制 #}
    <div style="display: none;">
        {{ form.DELETE }}
    </div>

    {# 添加一个删除按钮到右上角 #}
    <button type="button" class="action-btn btn-delete delete-row-btn">删除</button>

    <div class="fw-fields-grid">
        <div class="form-field">
            {{ form.shape.label_tag }} {{ form.shape }}
            <div class="errorlist">{{ form.shape.errors }}</div>
        </div>
        <div class="form-field">
            {{ form.repeat_count.label_tag }} {{ form.repeat_count }}
            <div class="errorlist">{{ form.repeat_count.errors }}</div>
        </div>
        <div class="form-field-checkbox">
            {{ form.has_trail }} {{ form.has_trail.label_tag }}
            <div class="errorlist">{{ form.has_trail.errors }}</div>
        </div>
        <div class="form-field-checkbox">
            {{ form.has_twinkle }} {{ form.has_twinkle.label_tag }}
            <div class="errorlist">{{ form.has_twinkle.errors }}</div>
        </div>
    </div>

    <div class="fw-color-section">
        <div class="fw-color-group">
            <label>主颜色</label>
            <div class="color-controls">
                <input type="color" class="color-picker" value="#ff0000">
                <button type="button" class="btn btn-secondary btn-sm add-color-btn">添加颜色</button>
                <label class="random-toggle"><input type="checkbox" class="random-color-cb"> 随机</label>
            </div>
            <div class="color-palette" data-type="colors"></div>
        </div>
        <div class="fw-color-group">
            <label>淡出颜色</label>
            <div class="color-controls">
                <input type="color" class="color-picker" value="#ffff00">
                <button type="button" class="btn btn-secondary btn-sm add-color-btn">添加颜色</button>
                <label class="random-toggle"><input type="checkbox" class="random-color-cb"> 随机</label>
            </div>
            <div class="color-palette" data-type="fade_colors"></div>
        </div>
    </div>

    {% if form.instance.pk %}
    <div class="delete-checkbox-container">
        {{ form.DELETE.label_tag }} {{ form.DELETE }}
    </div>
    {% endif %}
</div>